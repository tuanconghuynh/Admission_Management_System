<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Nh·∫≠t k√Ω h·ªá th·ªëng</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="style.css">
  <link rel="icon" type="image/png" href="hutech.png" sizes="32x32">
  <link rel="apple-touch-icon" href="hutech.png">
  <meta name="theme-color" content="#2563eb">

  <script>
    const isJournal = /\/journal\.html$/.test(location.pathname);
    if (isJournal && (location.search || location.hash)) {
      history.replaceState(null, '', location.pathname);
    }
  </script>

  <style>
    /* Hover nh·∫π logo */
    a:hover img { transform: scale(1.05); transition: transform 0.2s ease; }

    /* ·∫®n tri·ªát ƒë·ªÉ ph·∫ßn hard-delete n·∫øu kh√¥ng ph·∫£i Admin (ph√≤ng h·ªù) */
    :root[data-role="NhanVien"] #btnHardDelete,
    :root[data-role="NhanVien"] #hardDelConfirm,
    :root[data-role="NhanVien"] #btnHardDeleteGo,
    :root[data-role="NhanVien"] #btnHardDeleteCancel { display: none !important; }

    /* Chip action + status */
    .chip{display:inline-block;padding:.125rem .5rem;border-radius:9999px;border:1px solid #e5e7eb;background:#f8fafc;font-weight:600}
    .chip.PRINT,.chip.EXPORT{background:#eef2ff;border-color:#c7d2fe}
    .chip.UPDATE{background:#ecfeff;border-color:#a5f3fc}
    .chip.CREATE{background:#ecfdf5;border-color:#a7f3d0}
    .chip.DELETE_SOFT{background:#fff7ed;border-color:#fed7aa}
    .chip.DELETE,.chip.DELETE_HARD{background:#fef2f2;border-color:#fecaca}
    .chip.RESTORE{background:#f0fdf4;border-color:#bbf7d0}
    .chip.EXCEPTION{background:#fff1f2;border-color:#fecdd3}
    .status-ok{color:#16a34a;font-weight:700}
    .status-fail{color:#dc2626;font-weight:700}
    /* Batch update */
    .chip.BATCH_UPDATE{background:#eef2ff;border-color:#c7d2fe}
    .chip.BATCH_UPDATE_PREVIEW{background:#f5f3ff;border-color:#ddd6fe}

  </style>
</head>
<body class="min-h-screen flex flex-col bg-gray-50">
  <!-- Toast chung (n·∫øu c√≥ d√πng) -->
  <div id="toast-wrap"></div>

  <!-- Header chung AMS -->
  <header class="w-full bg-white/85 backdrop-blur-sm border-b border-slate-200">
    <div class="max-w-7xl mx-auto px-6 py-3 flex items-center gap-3">
      <a href="/ams_home.html"
         class="flex items-center gap-3 hover:opacity-90 transition"
         title="V·ªÅ trang ch·ªß">
        <img src="hutech.png" class="h-10 w-10" alt="HUTECH" />
        <div>
          <h1 class="text-2xl sm:text-3xl font-extrabold text-blue-700 leading-tight">
            ADMISSION MANAGEMENT SYSTEM - AMS
          </h1>
          <p class="text-sm sm:text-base text-gray-600 font-medium tracking-wide">
            V-HT.PTƒêT - H·ªá Th·ªëng Qu·∫£n L√Ω H·ªì S∆° Nh·∫≠p H·ªçc (AMS)
          </p>
        </div>
      </a>
    </div>
  </header>

  <!-- Main -->
  <main class="flex-1 flex">
    <!-- SIDEBAR -->
    <aside class="hidden md:flex md:flex-col w-64 bg-white/85 border-r border-slate-200 backdrop-blur-sm">

      <!-- Kh·ªëi user tr√™n c√πng sidebar (dropdown + ƒêƒÉng xu·∫•t) -->
      <div class="px-4 pt-4 pb-3 border-b border-slate-200 relative">
        <button id="userMenuBtn"
          class="w-full justify-between text-sm text-gray-700 bg-white hover:bg-slate-50 px-3 py-2 rounded-lg shadow border flex items-center gap-2"
          aria-haspopup="true" aria-expanded="false" aria-controls="userMenu">
          <span>
            <b id="helloName">‚Äî</b>
            <span class="text-gray-500">(<span id="helloRole">‚Äî</span>)</span>
          </span>
          <svg width="18" height="18" viewBox="0 0 20 20" fill="currentColor" class="text-gray-500" aria-hidden="true">
            <path fill-rule="evenodd"
              d="M5.23 7.21a.75.75 0 011.06.02L10 11.187l3.71-3.956a.75.75 0 011.08 1.04l-4.24 4.52a.75.75 0 01-1.08 0l-4.24-4.52a.75.75 0 01.02-1.06z"
              clip-rule="evenodd"/>
          </svg>
        </button>

        <!-- Dropdown user -->
      <div id="userMenu"
          class="menu absolute right-0 top-[calc(100%+4px)] w-48 md:w-56
            bg-white border rounded-lg shadow-md overflow-hidden z-20 text-xs"
          role="menu">
          <a href="/account" class="block px-4 py-2 hover:bg-gray-50" role="menuitem">üîé Th√¥ng tin t√†i kho·∫£n</a>
          <a href="/account" class="block px-4 py-2 hover:bg-gray-50" role="menuitem">üîê ƒê·ªïi m·∫≠t kh·∫©u</a>
          <button id="btnMenuLogout"
                  class="w-full text-left px-4 py-2 hover:bg-gray-50 text-red-600"
                  role="menuitem">
            ‚Ü©Ô∏è ƒêƒÉng xu·∫•t
          </button>
        </div>
      </div>

      <!-- Menu ch√≠nh -->
      <nav class="py-4 text-sm flex-1">
        <div class="px-4 pb-3 text-xs font-semibold text-gray-500 uppercase">
          Menu ch√≠nh
        </div>
        <a href="/ams_home.html"        class="nav-item">üè† Trang ch·ªß</a>
        <a href="/compilation.html"     class="nav-item">üìù Nh·∫≠p h·ªì s∆° m·ªõi</a>
        <a href="/students_list.html"   class="nav-item">üìã Danh s√°ch h·ªì s∆°</a>
        <a href="/import_students.html" class="nav-item">‚¨áÔ∏è Import h·ªçc vi√™n</a>
        <a href="/journal.html"         class="nav-item nav-item-active">üïì Nh·∫≠t k√Ω h·ªá th·ªëng</a>
        <a href="/checklist_admin.html" class="nav-item">üìë Qu·∫£n l√Ω danh m·ª•c h·ªì s∆°</a>
        <a href="/admin"                class="nav-item">üë§ Qu·∫£n l√Ω t√†i kho·∫£n</a>
      </nav>
    </aside>

    <!-- CONTENT -->
    <section class="flex-1 flex items-start justify-center">
      <div class="max-w-7xl mx-auto px-6 py-6 w-full">

        <!-- Ti√™u ƒë·ªÅ + API Base -->
        <header class="flex flex-wrap gap-3 items-center justify-between mb-4">
          <div class="min-w-0">
            <div class="flex items-center gap-2">
              <span class="inline-flex items-center justify-center w-9 h-9 rounded-full bg-blue-50 text-blue-700 text-xl">
                üïì
              </span>
              <h2 class="text-2xl font-bold leading-tight text-gray-800">Nh·∫≠t k√Ω h·ªá th·ªëng</h2>
            </div>
            <p class="text-gray-500 text-sm mt-1">
              L∆∞u tr·ªØ to√†n b·ªô c√°c ho·∫°t ƒë·ªông t·∫°i h·ªá th·ªëng!
            </p>
          </div>

          <div class="flex items-center gap-2">
            <label class="text-sm text-gray-500" for="apiBase">API Base</label>
            <input id="apiBase" class="input w-52 md:w-72" placeholder="" />
          </div>
        </header>

        <!-- Filters -->
        <section class="card space-y-3 mb-6">
          <div class="grid grid-cols-1 lg:grid-cols-6 gap-3 items-end">
            <div class="lg:col-span-2">
              <label class="text-sm text-gray-700 font-semibold">T·ª´ kh√≥a</label>
              <input id="q" class="input" placeholder="actor, path, correlation, IP‚Ä¶" />
            </div>
            <div>
              <label class="text-sm text-gray-700 font-semibold">Thao t√°c</label>
              <select id="qActionSel" class="input">
                <option value="">(T·∫•t c·∫£)</option>
                <option value="CREATE">T·∫°o m·ªõi</option>
                <option value="UPDATE">C·∫≠p nh·∫≠t</option>
                <option value="DELETE_SOFT">X√≥a t·∫°m</option>
                <option value="DELETE">X√≥a vƒ©nh vi·ªÖn</option>
                <option value="RESTORE">Kh√¥i ph·ª•c</option>
                <option value="PRINT_IN">In</option>
                <option value="EXPORT">Xu·∫•t Excel</option>
                <option value="EXCEPTION">L·ªói h·ªá th·ªëng</option>
                <option value="READ">Tra c·ª©u</option>
                <option value="BATCH_UPDATE">C·∫≠p nh·∫≠t h√†ng lo·∫°t</option>
                <option value="BATCH_UPDATE_PREVIEW">Xem tr∆∞·ªõc (batch)</option>
              </select>
            </div>
            <div class="hidden">
              <label class="text-sm text-gray-700 font-semibold">Target type</label>
              <input id="qType" class="input" placeholder="Applicant / User / ‚Ä¶" />
            </div>
            <div>
              <label class="text-sm text-gray-700 font-semibold">M√£ s·ªë HV</label>
              <input id="qId" class="input" placeholder="2510xxxxxx" />
            </div>
            <div>
              <label class="text-sm text-gray-700 font-semibold">Ng∆∞·ªùi thao t√°c</label>
              <input id="qActor" class="input" placeholder="T√™n ng∆∞·ªùi th·ª±c hi·ªán" />
            </div>
          </div>

          <div class="flex flex-wrap gap-2 items-center justify-between">
            <div class="flex flex-wrap gap-2 items-end">
              <div>
                <label class="text-sm text-gray-700 font-semibold">T·ª´ ng√†y</label>
                <input id="qFrom" type="date" class="input w-40" />
              </div>
              <div>
                <label class="text-sm text-gray-700 font-semibold">ƒê·∫øn ng√†y</label>
                <input id="qTo" type="date" class="input w-40" />
              </div>
            </div>
            <div class="flex gap-2">
              <button id="btnSearch" class="btn btn-outline">üîé L·ªçc</button>
              <button id="btnClear" class="btn btn-primary">X√≥a l·ªçc</button>
            </div>
          </div>
        </section>

        <!-- Table -->
        <section class="card space-y-3">
          <div class="flex items-center justify-between flex-wrap gap-2">
            <div class="flex items-center gap-3 text-sm text-gray-600">
              <span>T·ªïng: <span id="count" class="font-semibold">0</span> log</span>
              <div class="flex items-center gap-1">
                <label for="pageSize" class="text-gray-500">Hi·ªÉn th·ªã</label>
                <select id="pageSize" class="input w-20 text-sm">
                  <option selected>10</option>
                  <option>20</option>
                  <option>50</option>
                  <option>100</option>
                </select>
                <span class="text-gray-500">d√≤ng/trang</span>
              </div>
            </div>
            <div id="msg" class="text-sm text-gray-600" role="status" aria-live="polite"></div>
          </div>

          <div class="flex items-center justify-between gap-3">
            <div></div>
            <div class="flex items-center gap-1 text-sm pager" data-position="top">
              <button class="btn btn-outline btn-xs pager-first" title="Trang ƒë·∫ßu">‚èÆÔ∏è</button>
              <button class="btn btn-outline btn-xs pager-prev"  title="Trang tr∆∞·ªõc">‚è™</button>
              <span class="mx-2 min-w-[160px] text-center pager-info">Trang 1/1 ‚Ä¢ 0 m·ª•c</span>
              <button class="btn btn-outline btn-xs pager-next"  title="Trang sau">‚è©</button>
              <button class="btn btn-outline btn-xs pager-last"  title="Trang cu·ªëi">‚è≠Ô∏è</button>
            </div>
          </div>

          <div class="overflow-hidden border rounded-xl">
            <div id="emptyState" class="p-10 text-center text-gray-500 hidden">
              <div class="text-4xl mb-2">‚ùåüßæ</div>
              <div class="font-semibold">Kh√¥ng t√¨m th·∫•y trong danh s√°ch</div>
              <div class="text-sm">Nh·∫≠p t·ª´ kh√≥a kh√°c ƒë·ªÉ t√¨m ki·∫øm!</div>
            </div>

            <div id="tableWrap" class="overflow-auto hidden">
              <table class="table min-w-full">
                <thead>
                  <tr>
                    <th class="th-sortable text-left" data-sort="id">STT <span class="arrow">‚ñ≤‚ñº</span></th>
                    <th class="th-sortable text-center" data-sort="occurred_at">Th·ªùi gian <span class="arrow">‚ñ≤‚ñº</span></th>
                    <th class="th-sortable text-center" data-sort="actor_name">Ng∆∞·ªùi th·ª±c hi·ªán <span class="arrow">‚ñ≤‚ñº</span></th>
                    <th class="th-sortable text-center" data-sort="action">Thao t√°c <span class="arrow">‚ñ≤‚ñº</span></th>
                    <th class="th-sortable text-center" data-sort="target">MSSV <span class="arrow">‚ñ≤‚ñº</span></th>
                    <th class="th-sortable text-center" data-sort="status">Tr·∫°ng th√°i <span class="arrow">‚ñ≤‚ñº</span></th>
                    <th class="text-center">Corr</th>
                    <th class="text-center">Chi ti·∫øt</th>
                  </tr>
                </thead>
                <tbody id="tbody"></tbody>
              </table>
            </div>

            <div id="loading" class="p-8 text-center text-gray-500 hidden">
              <span class="inline-block w-5 h-5 border-2 border-gray-300 border-t-blue-600 rounded-full animate-spin align-[-2px]"></span>
              <span class="ml-2">ƒêang t·∫£i‚Ä¶</span>
            </div>
          </div>

          <div class="flex items-center gap-1 text-sm pager" data-position="bottom">
            <button class="btn btn-outline btn-xs pager-first" title="Trang ƒë·∫ßu">‚èÆÔ∏è</button>
            <button class="btn btn-outline btn-xs pager-prev"  title="Trang tr∆∞·ªõc">‚è™</button>
            <span class="mx-2 min-w-[160px] text-center pager-info">Trang 1/1 ‚Ä¢ 0 m·ª•c</span>
            <button class="btn btn-outline btn-xs pager-next"  title="Trang sau">‚è©</button>
            <button class="btn btn-outline btn-xs pager-last"  title="Trang cu·ªëi">‚è≠Ô∏è</button>
          </div>
        </section>
      </div>
    </section>
  </main>

  <!-- Footer -->
  <footer class="bg-[#1E50B4] text-white mt-auto">
    <div class="max-w-7xl mx-auto px-6 py-6 flex flex-col md:flex-row justify-between items-start md:items-center gap-6 text-sm">
      <div>
        <p class="font-semibold uppercase">VI·ªÜN H·ª¢P T√ÅC V√Ä PH√ÅT TRI·ªÇN ƒê√ÄO T·∫†O</p>
        <p class="uppercase">TR∆Ø·ªúNG ƒê·∫†I H·ªåC C√îNG NGH·ªÜ TPHCM (HUTECH)</p>
        <p><b>S√†i G√≤n Campus:</b> 475A ƒêi·ªán Bi√™n Ph·ªß, Ph∆∞·ªùng Th·∫°nh M·ªπ T√¢y, TP. H·ªì Ch√≠ Minh</p>
        <p>
          <b>ƒêT:</b> (028) 6686 6465 ¬∑
          <b>Email:</b>
          <a href="mailto:daotaotructuyen@hutech.edu.vn" class="underline hover:text-yellow-300">
            daotaotructuyen@hutech.edu.vn
          </a>
        </p>
      </div>
      <p class="text-xs">¬© V-HT.PTƒêT HUTECH ‚Äî Code by HC-Tu·∫•n</p>
    </div>
  </footer>

  <!-- Modal detail -->
  <div id="detail" class="fixed inset-0 z-[100] hidden items-center justify-center bg-black/50">
    <div class="bg-white w-[96vw] max-w-5xl max-h-[90vh] rounded-2xl shadow-2xl flex flex-col">
      <div class="flex items-center justify-between border-b px-4 py-3 sticky top-0 bg-white z-10">
        <strong>#Xem chi ti·∫øt ƒë·ªëi t∆∞·ª£ng   <span id="d_id"></span></strong>
        <div class="flex gap-2 flex-wrap">
          <button class="btn btn-outline btn-xs" id="btnCopy">üìã Sao ch√©p</button>
          <button class="btn btn-primary btn-xs" id="btnRestore">‚ôª Kh√¥i ph·ª•c</button>

          <!-- Hard delete -->
          <button class="btn btn-outline btn-xs" id="btnHardDelete" style="border-color:#dc2626;color:#dc2626">üóëÔ∏è X√≥a vƒ©nh vi·ªÖn</button>
          <button class="btn btn-primary btn-xs hidden" id="btnHardDeleteGo" style="background:#dc2626;border-color:#dc2626">OK X√≥a</button>
          <button class="btn btn-outline btn-xs hidden" id="btnHardDeleteCancel">H·ªßy</button>

          <button class="btn btn-outline btn-xs" id="btnClose">ƒê√≥ng</button>
        </div>
      </div>

      <!-- Panel x√°c nh·∫≠n hard delete -->
      <div id="hardDelConfirm" class="hidden px-4 pt-3">
        <div class="space-y-2">
          <div class="flex flex-wrap items-center gap-3">
            <label class="inline-flex items-center gap-2 select-none">
              <input id="hardDelConfirmChk" type="checkbox" class="w-4 h-4 accent-red-600" />
              <span class="text-sm font-medium text-gray-700">T√¥i x√°c nh·∫≠n x√≥a vƒ©nh vi·ªÖn</span>
            </label>
            <select id="hardDelReasonSel" class="input w-64">
              <option value="">-- Ch·ªçn l√Ω do --</option>
              <option value="TRUNG_LAP">H·ªì s∆° tr√πng l·∫∑p</option>
              <option value="NHAM_MSSV">Nh·∫ßm MSSV/m·ª•c ti√™u</option>
              <option value="YEU_CAU_NGUOI_DUNG">Y√™u c·∫ßu ng∆∞·ªùi d√πng x√≥a d·ªØ li·ªáu</option>
              <option value="TEST_DATA">D·ªØ li·ªáu th·ª≠ nghi·ªám</option>
              <option value="OTHER">L√Ω do kh√°c‚Ä¶</option>
            </select>
          </div>
          <div id="hardDelReasonWrap" class="hidden">
            <input id="hardDelReasonText" class="input w-full" placeholder="Nh·∫≠p l√Ω do kh√°c (b·∫Øt bu·ªôc)" />
            <p class="text-xs text-rose-600 mt-1">B·∫Øt bu·ªôc khi ch·ªçn ‚ÄúL√Ω do kh√°c‚Ä¶‚Äù.</p>
          </div>
          <p class="text-xs text-rose-600 mt-1 mb-2">
            H√†nh ƒë·ªông n√†y kh√¥ng th·ªÉ ho√†n t√°c. Vui l√≤ng x√°c nh·∫≠n tr∆∞·ªõc khi x√≥a!
          </p>
        </div>
      </div>

      <!-- Modal confirm restore -->
      <div id="confirmRestore" class="hidden fixed inset-0 bg-black/50 z-[9999] flex items-center justify-center">
        <div class="bg-white p-6 rounded-2xl shadow-xl max-w-sm text-center space-y-4">
          <div class="text-lg font-semibold text-gray-800">Kh√¥i ph·ª•c d·ªØ li·ªáu?</div>
          <div class="text-sm text-gray-500">
            X√°c nh·∫≠n kh√¥i ph·ª•c h·ªì s∆° MSSV <b id="restoreMSSV">‚Äî</b> t·ª´ th√πng r√°c.
          </div>
          <div class="flex justify-center gap-3 pt-2">
            <button id="btnConfirmRestoreYes" class="btn btn-primary px-4 py-1.5">OK</button>
            <button id="btnConfirmRestoreNo"  class="btn btn-outline px-4 py-1.5">H·ªßy</button>
          </div>
        </div>
      </div>

      <div id="d_view" class="p-4 overflow-auto flex-1"></div>
    </div>
  </div>

  <!-- Notification Toast -->
  <div id="notiBox" class="fixed inset-0 flex items-center justify-center z-[9999] pointer-events-none hidden">
    <div id="notiInner" class="px-6 py-3 rounded-xl shadow-xl text-white font-semibold text-center transition-all duration-300 scale-95 opacity-0 bg-blue-600"></div>
  </div>

<script src="journal.js"></script>
</body>
</html>
